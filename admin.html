<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RightClick Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  font-family:'Roboto',sans-serif;
}

body{
  background:#f5f8fb;
  color:#333;
}

/* HEADER */
header{
  display:flex;
  align-items:center;
  justify-content:center;
  background:#003366;
  padding:15px;
  color:white;
  flex-wrap:wrap;
}

header img{
  height:60px;
  margin-right:15px;
}

header h1{font-size:22px;}
header p{color:#ffd700;}

/* SEARCH */
.search-box{
  text-align:center;
  margin:20px;
}

.search-box input{
  width:90%;
  max-width:400px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

/* JOB CARDS */
#jobsContainer{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:15px;
  padding:20px;
}

.job-card{
  background:white;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
  transition:0.3s;
}
.job-card:hover{
  transform:translateY(-5px);
}

.job-card h4{
  color:#003366;
  margin-bottom:8px;
}

.job-card p{
  margin:4px 0;
}

/* STATUS BADGES */
.status-badge{
  padding:5px 10px;
  border-radius:12px;
  color:white;
  font-size:13px;
}

.Received{background:#007bff;}
.In-Progress{background:#ffc107;color:#333;}
.Ready{background:#28a745;}
.Delivered{background:#6c757d;}

/* CONTROLS */
.status-select{
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

.update-btn{
  padding:6px 12px;
  border:none;
  background:#003366;
  color:white;
  border-radius:6px;
  cursor:pointer;
}
.update-btn:hover{background:#0055aa;}
</style>
</head>

<body>

<header>
  <img src="logo.png">
  <div>
    <h1>RightClick Computer Sales & Service Center</h1>
    <p>Professional Device Service Management</p>
  </div>
</header>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search Job ID or Customer Name">
</div>

<div id="jobsContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB8uRXxvOyZeCUzPEt-pUytXj_R8N_JLww",
  authDomain: "rightclick-service-center.firebaseapp.com",
  projectId: "rightclick-service-center",
  storageBucket: "rightclick-service-center.firebasestorage.app",
  messagingSenderId: "558210394752",
  appId: "1:558210394752:web:a3f8663d7c6dc8cc88d465"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const jobsContainer = document.getElementById("jobsContainer");
const searchInput = document.getElementById("searchInput");

/* LOAD JOBS */
async function loadJobs(){
  jobsContainer.innerHTML="";
  const snap = await getDocs(collection(db,"jobs"));
  snap.forEach(docSnap=>{
    const job = docSnap.data();
    const statusClass = job.status.replace(/\s/g,"-");

    const card = document.createElement("div");
    card.className="job-card";

    card.innerHTML=`
      <h4>${job.jobId}</h4>
      <p><b>Name:</b> ${job.customerName}</p>
      <p><b>Mobile:</b> ${job.mobile}</p>
      <p><b>Item:</b> ${job.item}</p>
      <p><b>Status:</b>
        <span class="status-badge ${statusClass}">${job.status}</span>
      </p>

      <select class="status-select" id="select-${docSnap.id}">
        <option ${job.status=="Received"?"selected":""}>Received</option>
        <option ${job.status=="In Progress"?"selected":""}>In Progress</option>
        <option ${job.status=="Ready"?"selected":""}>Ready</option>
        <option ${job.status=="Delivered"?"selected":""}>Delivered</option>
      </select>

      <button class="update-btn" onclick="updateStatus('${docSnap.id}')">Update</button>
    `;
    jobsContainer.appendChild(card);
  });
}

/* UPDATE STATUS + SEND WHATSAPP */
window.updateStatus = async function(id){
  const select = document.getElementById(`select-${id}`);
  const newStatus = select.value;
  const ref = doc(db,"jobs",id);

  await updateDoc(ref,{status:newStatus});

  const card = select.closest(".job-card");
  const badge = card.querySelector(".status-badge");
  badge.textContent = newStatus;
  badge.className = "status-badge " + newStatus.replace(/\s/g,"-");

  const jobSnap = await getDoc(ref);
  const job = jobSnap.data();

  let time = "N/A";
  if(job.receivedDate?.toDate){
    const d = job.receivedDate.toDate();
    time = d.toLocaleString("en-IN");
  }

  const msg = encodeURIComponent(
`RightClick Computer Sales & Service Center

Hello ${job.customerName},

Your service status has been updated.

Job ID : ${job.jobId}
Item   : ${job.item}
Status : ${newStatus}

Received On :
${time}

Thank you for choosing RightClick.`
  );

  let mobile = job.mobile.toString();
  if(!mobile.startsWith("91")) mobile="91"+mobile;

  window.open(`https://wa.me/${mobile}?text=${msg}`,"_blank");
};

/* SEARCH */
searchInput.addEventListener("input",()=>{
  const filter = searchInput.value.toLowerCase();
  const cards = document.getElementsByClassName("job-card");

  Array.from(cards).forEach(card=>{
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(filter) ? "" : "none";
  });
});

loadJobs();
</script>
</body>
</html>
